<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/base.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- InstanceBeginEditable name="doctitle" -->
<title>KVS Programming Guide</title>
<!-- InstanceEndEditable -->
<link href="base.css" rel="stylesheet" type="text/css" media="screen, tv, projection" />
<!-- Code 装飾用 Google google-code-prettify -->
<!--<link rel="stylesheet" type="text/css" href="code-prettify/src/prettify.css">-->
<!--<link rel="stylesheet" type="text/css" href="../code-prettify/styles/desert.css">-->
<link rel="stylesheet" type="text/css" href="code-prettify/styles/tomorrow-night-blue.css">
<script type="text/javascript" src="code-prettify/src/prettify.js"></script>
<script type="text/javascript" src="code-prettify/src/lang-css.js"></script>
<!-- ここまで -->

<!-- InstanceBeginEditable name="head" -->
<!-- InstanceEndEditable -->
<!-- InstanceParam name="id" type="text" value="transFunc" -->
</head>

<body onload="PR.prettyPrint()" id="transFunc">
<div id="wrapper">
  <div id="header">
    <h1>KVS vsrsion 2.x Tutorial</h1>
    <p>&nbsp;</p>
    <p align="right"> kvs version 2.9</p>
    <p align="right">kvs : <a href=" https://github.com/naohisas/KVS" target="_blank"> https://github.com/naohisas/KVS</a></p>
  </div>
  <!-- end div#header -->
  
  <div id="sidebar">
  <!-- InstanceBeginEditable name="sidebarArea" -->
  <dl>
    <dd id="nInstall"><a href="install.html">インストール</a></dd>
    <dd id="nBasis"><a href="basis.html">基本的な使い方</a></dd>
    <dd id="nTransFunc"><a href="transFunc.html">伝達関数を調整する</a></dd>
  </dl>
  <p><strong><br />
  </strong></p>
  <p><strong> <a href="Program.html">KVSプログラムの作成</a></strong></p>
  <dl>
    <dd id="nProg01"><a href="Program01.html">3次元ベクトルの演算</a></dd>
    <dd id="nProgMatrix"><a href="ProgramMatrix.html">行列クラス</a></dd>
    <dd id="nProg02"><a href="Program02.html">行列の演算（行列クラスの応用）</a></dd>
    <dd id="nProgRandom"><a href="ProgramRandom.html">乱数生成</a></dd>
    <dd id="nProg03"><a href="Program03.html">オブジェクトについて</a></dd>
    <dd id="nProg04"><a href="Program04.html">構造型ボリュームデータの作成</a></dd>
    <dd id="nProg05"><a href="Program05.html">面データの可視化</a></dd>
    <dd id="nProgIso"><a href="ProgramIso.html">等値面の可視化</a></dd>
    <dd id="nProg06"><a href="Program06.html">可視化パイプライン</a></dd>
    <dd id="nProg07"><a href="Program07.html">レイキャスティングの実装</a></dd>
    <dd id="nProg08"><a href="Program08.html">PBVRの実装</a></dd>
    <dd id="nAppendix"><a href="Appendix.html">付録：プログラム集</a></dd>
  </dl>
  <!-- InstanceEndEditable -->
  </div>
  <!-- end div#sidebar -->

  <div id="main">
  <!-- InstanceBeginEditable name="mainArea" -->
  <h2>kvsviewのTransfer Function Editor を使う</h2>
  <p>kvsview のレイキャスティングレンダラーを使って伝達関数を変更してみる．</p>
  <p>伝達関数とは，<span class="pRed">ボリュームデータのスカラー値（密度値）と色・不透明度を対応付けるマッピングテーブル</span>のことをいいます．</p>
  <p>lobster のFLDファイル： <a href="Data/lobster.fld" target="_blank">lobster.fld</a></p>
  <p class="code">$ kvsview -RayCastingRenderer lobster.fld</p>
  <p>を実行するとレイキャスティングの結果が表示されます．  </p>
  <p class="image"><img src="img/kvsviewRayCasting0.png" width="300" alt="Ray Casting Renderer" /><br />
    レイキャスティング結果
  </p>
  <p>左下のカラーマップをダブルクリックすると，『Transfer Function Editor』が現れます．</p>
  <p class="image"><img src="img/TransferFunctionEditorORG.png" width="250" alt="Transfer Function Editor" /><br />
    Transfer Function Editor</p>
  <p>この『Transfer Function Editor』内の"Color"や"Opacity"をマウスで操作し．『Apply』ボタンをクリックすればレンダリング結果が変わります．ここで，Color は密度値に対して色を決定します．Opacity も同様に密度値に対して透明度を決定します．Opacityは直接マウスでラインを操作できます．</p>
  <p class="image"><img src="img/kvsviewRayCastingRed.png" width="300" alt="Ray Casting Renderer" />　<img src="img/TransferFunctionEditorRed.png" width="200" alt="Transfer Function" /><br />
  Transfer Function 操作結果</p>
  <p>色と透明度を変更した結果，レイキャスティング結果が変わっていることが確認できます．</p>
  <p>　　また，この変更後の伝達関数は『kvsml』形式で保存できます．『Save』ボタンを押せば，現在表示されている伝達関数を保存することができます．保存すると，</p>
<p>tfunc_日付_時間.kvsml</p>
  <p>というファイルが作成されます．</p>
  <h2>kvsml ファイルを作成する  </h2>
  <h3>1. DataArray型</h3>
  <p>上で作成したkvsmlファイル ： <a href="Data/tfunc.kvsml" target="_blank">tfunc.kvsml</a></p>
  <p>の中身は以下の通り．</p>
  <div class="DataFile">
  <p>&lt;?xml version=&quot;1.0&quot; ?&gt;</p>
  <p>&lt;!-- Generated by kvs::KVSMLTransferFunction::write() --&gt;</p>
    <p>  　&lt;KVSML&gt;</p>
    <p>　　&lt;TransferFunction resolution=&quot;256&quot; min_value=&quot;0&quot; max_value=&quot;0&quot;&gt;</p>
    <p>　　　&lt;ColorMap&gt;</p>
    <p>　　　　&lt;DataArray type=&quot;uchar&quot;&gt;</p>
    <p>　　　　　254 70 54 254 70 54 254 70 54 25</p>
    <p>　　　　　　　…</p>
    <p>　　　　&lt;/DataArray&gt;</p>
    <p>　　　&lt;/ColorMap&gt;</p>
    <p>　　　&lt;OpacityMap&gt;</p>
    <p>　　　　&lt;DataArray type=&quot;float&quot;&gt;</p>
    <p>　　　　　0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 </p>
    <p>　　　　　　　…</p>
    <p>　　　　&lt;/DataArray&gt;</p>
    <p>　　　&lt;/OpacityMap&gt;</p>
    <p>　　&lt;/TransferFunction&gt;</p>
    <p>&lt;/KVSML&gt;</p>
  </div>
<p>これは &quot;DataArray&quot; と書いてあるように，色と透明度が配列で表記されています．</p>
<p>ここでは，TransferFunction resolution=&quot;256&quot;　と書いてあることから，データ値（上の例ではlobster.fdの密度値）を256階調で表現しますということになります．</p>
<p>そのため，カラーマップ：</p>
<p>　　　　&lt;DataArray type=&quot;uchar&quot;&gt;</p>
<p>　　　　　254 70 54 254 70 54 254 70 54 25</p>
<p>は</p>
<p>データ値 0 のとき， R = 254, G = 70, B = 54</p>
<p>データ値 1 のとき， R = 254, G = 70, B = 54</p>
<p>…</p>
<p>のように，３つで1つのデータの色を表しています．</p>
<p>（全部でresolution × 3　個のデータが並んでいます）</p>
<p>次に，オパシティ：</p>
<p>　　　　&lt;DataArray type=&quot;float&quot;&gt;</p>
<p>　　　　　0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</p>
<p>はカラーマップと同様に</p>
<p>データ値 0 のとき，透明度 0</p>
<p>データ値 1 のとき，透明度 1</p>
<p>…</p>
<p>のようにデータ値と透明度の値が1対１の関係になります．</p>
<p>（全部で resolution 個のデータが並んでいます）</p>
<p>このままでは，編集が大変なので，次のような書き方もできます．</p>
<p>&nbsp;</p>
<h3>2. データポイントだけを記述したkvsmlファイル</h3>
<p>編集しやすい（？）kvsmlLファイル：<a href="Data/testFunc1.kvsml" target="_blank">testFunc1.kvsml</a></p>
<p>中身は以下の通り．</p>
<div class="DataFile">
  <p>&lt;?xml version=&quot;1.0&quot; ?&gt;</p>
  <p>&lt;KVSML&gt;</p>
<p>　&lt;TransferFunction resolution=&quot;256&quot;&gt;</p>
  <p> 　　&lt;ColorMap&gt;</p>
  <p> 　　　&lt;ColorMapValue s=&quot;0&quot; r=&quot;255&quot; g=&quot;255&quot; b=&quot;255&quot;/&gt;</p>
  <p> 　　　&lt;ColorMapValue s=&quot;255&quot; r=&quot;255&quot; g=&quot;0&quot; b=&quot;0&quot;/&gt;</p>
  <p> 　　&lt;/ColorMap&gt;</p>
  <p> 　　&lt;OpacityMap&gt;</p>
  <p> 　　　&lt;OpacityMapValue s=&quot;0&quot; a=&quot;0&quot;/&gt;</p>
  <p> 　　　&lt;OpacityMapValue s=&quot;50&quot; a=&quot;0&quot;/&gt;</p>
  <p> 　　　&lt;OpacityMapValue s=&quot;255&quot; a=&quot;1&quot;/&gt;</p>
  <p> 　　&lt;/OpacityMap&gt;</p>
  <p> 　&lt;/TransferFunction&gt;</p>
  <p>&lt;/KVSML&gt;</p>
</div>
<p></p>
<p>このデータを</p>
<p class="code"># kvsview -TransferFunction testFunc1.kvsml -c</p>
<p>で描画すると，</p>
<p class="image"><img src="img/TransFuncRed.png" width="512" height="93" alt="Red Color" /><br />
カラーマップ表示</p>
<p>白から赤へ変化するようなカラーマップだということがわかります．</p>
<p>これは，</p>
<p>　　　&lt;ColorMapValue s=&quot;0&quot; r=&quot;255&quot; g=&quot;255&quot; b=&quot;255&quot;/&gt;</p>
<p> 　　　&lt;ColorMapValue s=&quot;255&quot; r=&quot;255&quot; g=&quot;0&quot; b=&quot;0&quot;/&gt;</p>
<p>の通り，</p>
<p>s=&quot;0&quot; r=&quot;255&quot; g=&quot;255&quot; b=&quot;255&quot;　では，データ値が 0 のとき，R = 255, G = 255 , B = 255　(白)</p>
<p>s=&quot;255&quot; r=&quot;255&quot; g=&quot;0&quot; b=&quot;0&quot;　では，データ値が 255 のとき，R = 255, G = 0 , B = 0　(赤）</p>
<p>となり，その間の色は各色について線形補間した値が採用されます．</p>
<p>オパシティも同様に，設定した場所での値以外は線形補間で表されるので，この例ではオパシティカーブは</p>
<p> 0 ～ 50 の間は　0，50 ～ 255 の間は 0 -1 を結ぶ直線で補間された値になります．</p>
<p>カラーマップを確認したときと同様に，オプションを『-a』とすれば：</p>
<p class="code">$ kvsview -TransferFunction testFunc1.kvsml<strong> -a</strong></p>
<p>オパシティマップを確認することができます．</p>
<p>&nbsp;</p>
<p>このカラーマップを使って先ほどと同様に lobster.fld を描画：</p>
<p class="code">$ kvsview -RayCastingRenderer lobster.fld -t testFunc1.kvsml</p>
  <p>すると以下のような絵になります．</p>
  <p>&nbsp;</p>
  <p class="image"><img src="img/RedLobster.png" width="300" alt="Red Lobster" />　<img src="img/RedLobsterFunc.png" width="200" alt="Red Lobster Func" /><br />
    testFunc1.kvsmlを使って例キャスティングした結果</p>
  <p>このように，必要なポイントだけを書いておくこともできます．</p>
  <p>また，１と２の記述方法は混在していても大丈夫です．</p>
  <p>つまり，ColorMap は１．のDataArray でかき， OpasityMap は２．のデータポイントだけ書くということもできます．</p>
  <p>混合させたkvsmlファイル：<a href="Data/testFunc.kvsml" target="_blank">testFunc.kvsml</a></p>
  <p>&nbsp;</p>
  <p>&nbsp;</p>
  <p align="right">Modefied at June 28, 2011</p>
  <p align="right">Modefied at June 1, 2015</p>
  <p align="right">Modefied at April 12, 2017  </p>
    <p>&nbsp;</p>
  <p>&nbsp; </p>
  <!--&nbsp;</p>
  <p>% kvsview -TransferFunction lobster.fld </p>
  <p>&nbsp;</p>-->
  <p>&nbsp;</p>
  <!-- InstanceEndEditable -->
  </div>
  <!-- end div#main -->

  <div id="fotter">
    <p><a href="index.html">TOP</a>　</p>
  </div>
  <!-- end div#fotter -->
    
</div>
<!-- end div#wrapper -->

</body>
<!-- InstanceEnd --></html>
